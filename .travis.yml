language: python
sudo: false
python:
  - "2.7"
install:
  - pip install -r requirements.txt
  - npm install -g grunt-cli bower
script:
  - python manage.py migrate --fake-initial
  - python manage.py compile_frontend
before_deploy:
  - cd $TRAVIS_BUILD_DIR
  - export PATH=$TRAVIS_BUILD_DIR:$PATH
  - travis_retry curl -L -o cf.tgz "https://cli.run.pivotal.io/stable?release=linux64-binary&version=6.15.0"
  - tar xzvf cf.tgz
  - mkdir -p ${TRAVIS_BUILD_DIR}/Godeps/_workspace
  - export GOPATH=${TRAVIS_BUILD_DIR}/Godeps/_workspace
  - go get github.com/concourse/autopilot
  - cf install-plugin -f $GOPATH/bin/autopilot
deploy:
  provider: script
  script: ./deploy-travis.sh
